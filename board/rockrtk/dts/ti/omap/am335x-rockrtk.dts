/dts-v1/;

#include "am33xx.dtsi"
#include "am335x-rockrtk-pinmux.dtsi"

/ {
	model = "AM335x RockRTK Board";
	compatible = "ti,am33xx";

    cpus {
		cpu@0 {
			cpu0-supply = <&dcdc2_reg>;
		};
	};

	memory@80000000 {
		device_type = "memory";
		reg = <0x80000000 0x20000000>; /* 512 MB */
	};

	chosen {
		stdout-path = &uart0;
	};

	leds {
        compatible = "gpio-leds";

        status_led {
            label = "status:green";
            gpios = <&gpio0 13 GPIO_ACTIVE_HIGH>;  
            default-state = "off";  
            linux,default-trigger = "heartbeat";  
        };
    };

	gpio-export {
        compatible = "gpio-export";
        #size-cells = <0>;

        lte_power {
            gpio-export,name = "lte_pwr";
            gpios = <&gpio0 31 GPIO_ACTIVE_HIGH>;
            gpio-export,output = <1>;  
        };
    };

	vmmcsd_fixed: fixedregulator0 {
		compatible = "regulator-fixed";
		regulator-name = "vmmcsd_fixed";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
	};

	wifi_pwrseq: wifi_pwrseq {
		compatible = "mmc-pwrseq-simple";
		reset-gpios = <&gpio0 27 GPIO_ACTIVE_LOW>;
 		clocks = <&clk_24mhz_clkctrl AM3_CLK_24MHZ_CLKDIV32K_CLKCTRL 0>;
		clock-names = "ext_clock";
	};
};


&cpu0_opp_table {
	/*
	 * All PG 2.0 silicon may not support 1GHz but some of the early
	 * BeagleBone Blacks have PG 2.0 silicon which is guaranteed
	 * to support 1GHz OPP so enable it for PG 2.0 on this board.
	 */
	opp-1000000000 {
		/* OPP Nitro */
		opp-supported-hw = <0x06 0x0100>;
	};
};

&uart0 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart0_pins>;

	status = "okay";
};

&usb0 {
	dr_mode = "host";
};

&usb1 {
	dr_mode = "host";
};

&i2c0 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c0_pins>;

	status = "okay";
	clock-frequency = <400000>;

	tps: tps@24 {
 		reg = <0x24>;
	};

	baseboard_eeprom: baseboard_eeprom@50 {
		compatible = "atmel,24c256";
		reg = <0x50>;
		vcc-supply = <&ldo4_reg>;

		nvmem-layout {
			compatible = "fixed-layout";
			#address-cells = <1>;
			#size-cells = <1>;

			baseboard_data: baseboard_data@0 {
				reg = <0 0x100>;
			};
		};
	};
};

#include "am335x-rockrtk-pmic.dtsi"

&cpsw_port1 {
	phy-handle = <&ethphy0>;
	phy-mode = "mii";
	ti,dual-emac-pvid = <1>;
};

&cpsw_port2 {
	status = "disabled";
};

&mac_sw {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&cpsw_default>;
	pinctrl-1 = <&cpsw_sleep>;
	status = "okay";
};

&davinci_mdio_sw {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&davinci_mdio_default>;
	pinctrl-1 = <&davinci_mdio_sleep>;

	ethphy0: ethernet-phy@0 {
		reg = <0>;
		reset-assert-us = <300>;
		reset-deassert-us = <13000>;
	};
};

&mmc1 {
	status = "okay";
    vmmc-supply = <&vmmcsd_fixed>;
	bus-width = <0x4>;
	pinctrl-names = "default";
	pinctrl-0 = <&mmc1_pins>;
	cd-gpios = <&gpio0 6 GPIO_ACTIVE_LOW>;
};

&mmc2 {
	vmmc-supply = <&vmmcsd_fixed>;
	pinctrl-names = "default";
	pinctrl-0 = <&emmc_pins>;
	bus-width = <8>;
	status = "okay";
	non-removable;
};

&mmc3 {
    status = "okay";
    vmmc-supply = <&vmmcsd_fixed>;   
    pinctrl-names = "default";
    pinctrl-0 = <&ap6256_mmc3_pins>;
    bus-width = <4>;

	dmas = <&edma_xbar 12 0 1
			&edma_xbar 13 0 2>;
	dma-names = "tx", "rx";
 
    mmc-pwrseq = <&wifi_pwrseq>;
    max-frequency = <50000000>;

	#address-cells = <1>;
	#size-cells = <0>;
	no-1-8-v;
	ti,non-removable;
	ti,needs-special-hs-handling;
	cap-power-off-card;
	keep-power-in-suspend;
};

// &gpio0 {
//     wl_reg_on_hog: wl_reg_on_hog {
//         gpio-hog;
//         gpios = <27 GPIO_ACTIVE_HIGH>;
//         output-high;
//         line-name = "wl_reg_on_force";
//     };
// };

&aes {
	status = "okay";
};

&sham {
	status = "okay";
};

&rtc {
	clocks = <&clk_32768_ck>, <&clk_24mhz_clkctrl AM3_CLK_24MHZ_CLKDIV32K_CLKCTRL 0>;
	clock-names = "ext-clk", "int-clk";
	system-power-controller;
};

&wkup_m3_ipc {
	firmware-name = "am335x-bone-scale-data.bin";
};
